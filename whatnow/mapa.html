<html>
<head>
    <script type="text/javascript" src="jquery-1.11.3.min.js"></script>
    <title>bananaman</title>

    <style type="text/css">
    
        #mototaxi { position:fixed; left:50%; margin-left:-256px; top:50%; margin-top:-256px; }
    
    </style>
</head>
  <body>  
    <img id="tile" src="planettile.png" style="display:none;">
    
      
      
      <canvas id="mototaxi" width="544" height="544" style="border:1px solid #000000;">
    
    </canvas>
      
      
<script>
    


window.onload = function() {
	
	var canvas = document.getElementById("mototaxi");
	var ctx = canvas.getContext("2d");
	var img = document.getElementById("tile");
    var personImg = ctx.drawImage(img,64,0,32,32,personX*32,personY*32,32,32);
    
	var tileArray=[1,0,0];
    
	var personX=8;
	var personY=8;
	
	var personPos = [personX][personY];
	
    var newLine=[];
	
	
	var mapPosX=0;
	var mapPosY=0;
	
	var map = [];
	
	//desenha mapa
	function desenhaMapa(){
	for(var i=0; i<map.length; i++){
		mapPosX=0;
		for(var k=0; k<map[i].length; k++){
			if (map[i][k]==0){
				
				ctx.drawImage(img,0,0,32,32,mapPosX,mapPosY,32,32);
			}
			else{
				ctx.drawImage(img,32,0,32,32,mapPosX,mapPosY,32,32);
				
			}
			mapPosX+=32;
		}
		mapPosY+=32;
	}
    mapPosX=0;
    mapPosY=0;
    }
	
    map = [
	[1,1,0,0,0,0,1,1,0,0,0,1,0,0,0,1,1],
	[1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1],
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1],
	[0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0],
	[1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0],
	[1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
	[1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
	[0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
	[1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1],
	[0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1],
	[0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
	[1,0,1,0,0,1,0,0,0,1,0,0,1,0,0,0,1]
	];
    
    desenhaMapa();
    
	ctx.drawImage(img,64,0,32,32,personX*32,personY*32,32,32);
    
	function colision(){
        alert("Bateste foi.");
        map = [
	[1,1,0,0,0,0,1,1,0,0,0,1,0,0,0,1,1],
	[1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1],
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1],
	[0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0],
	[1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0],
	[1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
	[1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
	[0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
	[1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1],
	[0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1],
	[0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
	[1,0,1,0,0,1,0,0,0,1,0,0,1,0,0,0,1]
	];
        console.log(newLine);
        desenhaMapa();
        ctx.drawImage(img,64,0,32,32,personX*32,personY*32,32,32);
    }
    
    //MOVIMENTAÇÃO ANTIGA
    
    /*function movePersonUp(){
        personY--;
        if (map[personY][personX]==1){
            colision();
        }else{
            desenhaMapa();
            ctx.drawImage(img,64,0,32,32,personX*32,personY*32,32,32);
        }
    }
    function movePersonDown(){
        personY++;
        if (map[personY][personX]==1){
            colision();
        }else{
            desenhaMapa();
            ctx.drawImage(img,64,0,32,32,personX*32,personY*32,32,32);
        }
    }
    function movePersonRight(){
        personX++;
        if (map[personY][personX]==1){
            colision();
        }else{
            desenhaMapa();
            ctx.drawImage(img,64,0,32,32,personX*32,personY*32,32,32);
        }
    }
    
    function movePersonLeft(){
        personX--;
        if (map[personY][personX]==1){
            colision();
        }else{
            desenhaMapa();
            ctx.drawImage(img,64,0,32,32,personX*32,personY*32,32,32);
        }
    }*/
        
    
    
        //NOVA MOVIMENTAÇÃO (MOVENDO E GERANDO MUNDO NOVO)
    
        function movePersonUp(){
            newLine=[];
            for(var i=0; i<map.length;i++){ 
                newLine.push(tileArray[Math.floor(Math.random() * tileArray.length)]);    
            }
            
            map.unshift(newLine); //adiciona newLine como primeira posiçao do array
            map.pop(); //deleta o ultimo termo do array
            
            if (map[personY][personX]==1){
                colision();
                
            }else{
                desenhaMapa();
                ctx.drawImage(img,64,0,32,32,personX*32,personY*32,32,32);
            }     
        }
    
        function movePersonDown(){
            newLine=[];
            for(var i=0; i<map.length;i++){ 
                newLine.push(tileArray[Math.floor(Math.random() * tileArray.length)]);    
            }
            
            map.push(newLine); //adiciona newLine como ultimo termo do array
            map.shift(); //deleta o primeiro termo do array
            
            if (map[personY][personX]==1){
                colision();
                
            }else{
                desenhaMapa();
                ctx.drawImage(img,64,0,32,32,personX*32,personY*32,32,32);
            }  
        }
    
        function movePersonRight(){
            
            for(var i=0; i<map.length;i++){
                map[i].splice(0,1); //deleta o primeiro termo do array
                map[i].push(tileArray[Math.floor(Math.random() * tileArray.length)]); // adiciona o valor randomizado no final do array
            }
            
            
            if (map[personY][personX]==1){
                colision();
                
            }else{
                desenhaMapa();
                ctx.drawImage(img,64,0,32,32,personX*32,personY*32,32,32);
            }  
        }
    
        function movePersonLeft(){
           
            for(var i=0; i<map.length;i++){
                map[i].pop; // deleta o último termo do array
                map[i].unshift(tileArray[Math.floor(Math.random() * tileArray.length)]); // adiciona o valor randomizado no início do array
            }
            
            
            if (map[personY][personX]==1){
                colision();
                
            }else{
                desenhaMapa();
                ctx.drawImage(img,64,0,32,32,personX*32,personY*32,32,32);
            }  
        }
    
    
    
    
	$(function(){
		$(document).keyup(function(e){
			if(e.keyCode==38){ //move pra cima
				movePersonUp();
                }else if(e.keyCode==40){ //move pra baixo
                    movePersonDown();
                }else if(e.keyCode==39){ // move pra direita
                    movePersonRight();
                }else if(e.keyCode==37){ // move pra esquerda
                    movePersonLeft();
                }
				
			
			
		});
		
	});
	
}

</script>
    

    </body>
</html>